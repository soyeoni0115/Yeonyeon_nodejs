# 웹 소켓 이해하기

- Node) 웹 소켓 = Socket.IO ?  => X
  (Socket.IO: 웹 소켓을 활용한 라이브러리)
  
- 웹 소켓: HTML5에 새로 추가된 스펙으로 실시간 양방향 데이터 전송을 위한 기술.
  - HTTP와 달리 WS라는 프로토콜 사용
  - 최신 브라우저는 대부분 웹 소켓 지원
  - 노드에서는 ws나 Socket.IO로 사용 가능
  - 처음에 웹 소켓이 연결되면 그 다음부터는 계속 연결된 상태이므로 업데이트 요청 보낼 필요가 없음.
  - HTTP 프로토콜과 포트를 공유할 수 있으므로 다른 포트에 연결할 필요도 없음
    
- 폴링: 웹 소켓 이전에 사용된 기술로 HTTP 기술을 사용해 실시간 데이터 전송을 구현하는 단방향 통신

- 서버센트 이벤트(SSE): Event Source라는 객체 사용하여 처음에 한 번만 연결하면 서버가 클라이언트에 지속적으로 데이터 전송
  - 클라이언트에서 서버로는 데이터를 보낼 수 없다는 점이 웹 소켓과 다름 (=단방향 통신(데이터-> 클라이언트))
  - SSE에서 할 수 있는 것은 웹 소켓으로 모두 사용 가능
  - SSE 사용하는 이유) 양방향 통신을 할 필요가 없는 경우가 있음 (ex: 주식 차트 업데이트, SNS에서 새 게시물 가져오기
 
- Socket.IO: 웹 소켓을 편리하게 사용할 수 있도록 도와주는 라이브러리
  -웹 소켓을 지원하지 않는 IE9와 같은 브라우저에서 알아서 웹 소켓 대신 폴링 방식으로 실시간 데이터 전송을 가능하게 함


# ws 모듈로 웹 소켓 사용하기
- 프로젝트 생성 -> .env와 app.js, routes/index.js 작성 ->ws 모듈 설치 -> 웹 소켓을 익스프레스 서버에 연결 ->socket.js파일 작성 ->ws 모듈을 불러오고 익스프레스 서버를 웹 소켓 서버와 연결
- 연결 후에는 웹 소켓 서버에 이벤트 리스너 붙임(웹 소켓은 이벤트 기반 동작) -> 실시간으로 데이터를 전달받으므로 항상 대기
- connection 이벤트는 클라이언트가 서버와 웹 소켓 연결을 맺을 때 발생
- 익스프레스 서버와 연결 후 웹 소켓 객체에 이벤트 리스너들을 연결
- 웹 소켓은 단순히 서버에서 설정한다고 작동하는 것 아니기에 클라이언트에서도 웹 소켓을 사용해야함. -> views 폴더 생성후 index.html파일 작성하여 script태그에 웹 소켓 코드 삽입.
- 서버 실행하면 3초마다 콘솔에 3초마다 메시지 찍힘.
  - 3초마다 메시지가 오지만 네트워크 요청은 단 두번(폴링이었다면 메시지 보낼 때마다 요청을 했을 것)
  - 클라이언트가 연결중으로 상태가 바뀌면 노드 서버에 오는 메시지 양이 두배로 늘게 됨
 
# Socket.IO 사용
- ws 패키지는 간단하게 웹 소켓을 사용하려 할 때는 좋으나 구현하려는 서비스가 복잡해지면 Socket.IO가 더 편리함
- 먼저 ws패키지 대신 Socket.IO 연결 -> 익스프레스 서버와 연결 (SocketIO 객체의 두번째 인수로 옵션 객체 삽입 가능. 여기에선 path옵션만 사용)
- 연결 후에는 이벤트 리스너 붙이고 socket에도 이벤트 리스너를 붙임. 이때 이벤트명을 사용하는 것이 ws 모듈과는 다름
- index.html에서 스크립트로 /socket.io/socket.io.js는 Socket.IO에서 클라이언트로 제공되는 스크립트고 실제 파일이 아님. 그냥 그런 라우터가 생겼다고 생각하면 됌
- 스크립트가 제공하는 io객체에 서버 주소를 적어 연결함(http프로토콜을 사용하는 것이 ws모듈과 다름)
- Socket.IO는 먼저 폴링 방식으로 서버와 연결함. 폴링 연결 후 웹 소켓을 사용할 수 있다면 웹 소켓으로 업그레이드 (웹 소켓 사용 불가 시 폴링 방식으로)
